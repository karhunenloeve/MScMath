# .github/workflows/latex-commit-thesis-pdfs.yml
name: build-and-commit-thesis-pdf

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    if: github.actor != 'github-actions[bot]'
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: true

      - name: Compile Thesis with LuaLaTeX
        uses: xu-cheng/latex-action@v3
        with:
          latexmk_use_lualatex: true
          args: -interaction=nonstopmode -halt-on-error -file-line-error
          root_file: |
            Thesis.tex

      - name: Collect PDF into generated-pdfs
        run: |
          mkdir -p generated-pdfs
          mv -f Thesis.pdf generated-pdfs/Thesis.pdf

      - name: Commit and push PDF
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add generated-pdfs/Thesis.pdf

          if git diff --cached --quiet; then
            echo "No PDF changes to commit."
            exit 0
          fi

          git commit -m "Update Thesis PDF [skip ci]"
          git push
